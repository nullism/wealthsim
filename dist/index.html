<!DOCTYPE html>
<html>
<head>
<title>Wealth Simulator</title>

<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script
<script
  src="http://code.jquery.com/jquery-3.3.1.min.js"
  integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
  crossorigin="anonymous"></script>

<script>
var actors = {};
var actorCount = 100;
var redistribution = 0;
var redistributionPool = 0;
var flatTax = 0;
var wealthGap = 0;
var investmentAmount = 0.0;
var investmentChance = 0.01;

var sharePrice;
var totalShares;
var boughtShares;


var totalWealth = 10000;
var spendAmount = 1;
var cycles = 10000;

// Internal
var investmentPool = 0;
var currentWealth;

function displayResults() {
  var poorestEl = $("#poorest");
  var richestEl = $("#richest");
  
  poorest = getPoorestActor();
  richest = getRichestActor();

  poorestEl.html(precisionRound(poorest.wealth, 2));
  richestEl.html(precisionRound(richest.wealth, 2));
}

function getRichestActor() {
  var richest = actors[0];
  for(var i=0; i<actors.length; i++) {
    var actor = actors[i];
    if (actor.wealth > richest.wealth) richest = actor;
  }
  return richest;
}

function getPoorestActor() {
  var poorest = actors[0];
  for(var i=0; i<actors.length; i++) {
    var actor = actors[i];
    if (actor.wealth < poorest.wealth) poorest = actor;
  }
  return poorest;
}

function start() {
  console.log("Starting...");
  currentWealth = totalWealth;
  totalShares = actorCount * 10;
  boughtShares = 0;

  actors = [];

  for(var i=0; i<actorCount; i++) {
    var initialWealth = currentWealth / actorCount;
    var actor = { 
      id: i,
      wealth: initialWealth,
      startWealth: initialWealth,
      shares: 0,
      spent: 0 };
    actors.push(actor);       
  }

  $("input").prop("disabled", true);

  for(var i=0; i<cycles; i++) {
    doCycle(i);
  }

  $("input").prop("disabled", false);
  displayResults();
}

function doCycle(cycle) {


  for(var i=0; i<actors.length; i++) {

    sharePrice = (boughtShares / totalShares) * (totalWealth / actorCount);
    var actor = actors[i];
    // Investments
    var sharesLeft = totalShares - boughtShares;


    if ((sharesLeft > 0) && (actor.wealth * investmentAmount) > sharePrice) {
      // Buy Shares
      
      actor.wealth -= sharePrice;
      actor.shares += 1;
      investmentPool += sharePrice;
      boughtShares += 1;
    }

    // Pay dividends
    var sharePct = actor.shares / boughtShares;
    if (sharePct > 0) {
      var earned = investmentPool * sharePct;
      actor.wealth += earned;
      investmentPool -= earned;
    }




    // Spending
    if (actor.wealth >= spendAmount) {
      actor.wealth -= spendAmount;
      actor.spent += spendAmount;
  
      if ((Math.random() < investmentChance) && (investmentAmount > 0)) {
        // Buy something
        investmentPool += spendAmount;
      } else {

        // Give to another random actor
        var actor2 = actors[Math.floor(Math.random() * actors.length)];
        actor2.wealth += spendAmount;
      }
    }

    // Wealth redistribution
    var distribute = actor.wealth * redistribution;
    if (distribute > 0) {
      redistributionPool += distribute;
      actor.wealth -= distribute;    
    }

    // Collect redistribution
    if (redistributionPool > 0) {
      var collect = redistributionPool / actorCount;
      redistributionPool -= collect;
      actor.wealth += collect;
    }

  }

  investmentPool = precisionRound(investmentPool, 10);
  redistributionPool = precisionRound(redistributionPool, 10);
}

function precisionRound(number, precision) {
  var factor = Math.pow(10, precision);
  return Math.round(number * factor) / factor;
}

$(document).ready(function() {

  $("input[type=radio][name=flatTax]").change(function() {
    flatTax = this.value;
  });

  $("input[type=radio][name=wealthGap]").change(function() {
    wealthGap = this.value;
  });

  $("input[type=radio][name=redistribution]").change(function() {
    redistribution = this.value;
  });

  $("input[type=radio][name=investmentAmount]").change(function() {
    investmentAmount = this.value;
  });

  $("input[type=radio][name=investmentChance]").change(function() {
    investmentChance = this.value;
  });


  $("input[type=number][name=actorCount]").change(function() {
    actorCount = this.value;
  });

  $("input[type=number][name=totalWealth]").change(function() {
    totalWealth = this.value;
   
  });

  $("input[type=number][name=spendAmount]").change(function() {
    spendAmount = parseInt(this.value);
  });

  


});

</script>

</head>
<body><div class="container">

<div>
  <h2>About</h2>

  <p>
    With the default settings this project simulates 1,000 people who can spend $1 each cycle on 
    goods and services from a randomly selected person for 10,000 cycles, and shows the resulting wealth distribution. 
  </p>
  <p>
    The goal of the project is to show how extreme wealth gaps might develop naturally and test which variables might stabilize the middle class.
  </p>

  <h3>Major Differences from Reality</h3>
  <ul>
    <li>All people have equal education, skill, and initial wealth.</li>
    <li>All people follow the same rules.</li>
    <li>
      All people spend the same amount on goods and services from each other and companies. Luxury spending isn't part of this simulation, only necessities. 
    </li>
    <li>
      There is no notion of inheritance or family wealth. 
    </li>
  </ul>
</div>


<div class="card"><div class="card-body">
  <h5 class="card-title">Basic Settings</h5>

  <div class="form-group">
    <label>Number of People</label>
    <input class="form-control" type="number" name="actorCount" value="100">
    <small class="form-text text-muted">
      How many people are in this economy. Larger values will take longer to simulate.
    </small>
  </div>

  <div class="form-group">
    <label>Total Wealth</label>
    <input class="form-control" type="number" name="totalWealth" value="10000">
    <small class="form-text text-muted">
      How much total money exists in this economy.
    </small>
  </div>

  <div class="form-group">
    <label>Spending Amount</label>
    <input class="form-control" type="number" name="spendAmount" value="1">
    <small class="form-text text-muted">
      How much each person spends per cycle. This value must be greater than 0.
    </small>
  </div>




  <!--
  <h3>Initial Wealth Gap</h3>
  <p>The difference in wealth between the richest 10% and poorest 90%</p>

  None <input type="radio" name="wealthGap" value="0" checked><br>
  Tiny 20% <input type="radio" name="wealthGap" value="0.2"><br>
  Moderate 50% <input type="radio" name="wealthGap" value="0.5"><br>
  USA 300% <input type="radio" name="wealthGap" value="3.0"><br>
  -->
</div></div>

<!--
<div>
  <h2>Tax Rate</h2>
  <h3>Flat Tax</h3>
  <p>This is a flat tax rate. The money collected from this does not directly go to 
  the actors.</p>

  None <input type="radio" name="flatTax" value="0.1" checked><br> 
  Small 10% <input type="radio" name="flatTax" value="0.1" onchang><br> 
  Moderate 20% <input type="radio" name="flatTax" value="0.2"><br> 
  Large 40% <input type="radio" name="flatTax" value="0.4"><br>
</div>
-->

<div class="card" style="margin-top: 1em;"><div class="card-body">
  <h5 class="card-title">Advanced Settings</h5>

  <div class="form-group">
    <label>Wealth Redistribution</label>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="red1" name="redistribution" value="0" checked>
      <label class="form-check-label" for="red1">Off</label>
    </div>

    <div class="form-check"> 
      <input class="form-check-input" type="radio" id="red2" name="redistribution" value="0.01">
      <label class="form-check-label" for="red2">Tiny (1%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="red3" name="redistribution" value="0.05">
      <label class="form-check-label" for="red3">Small (5%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="red4" name="redistribution" value="0.1">
      <label class="form-check-label" for="red4">Moderate (10%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="red5" name="redistribution" value="0.1">
      <label class="form-check-label" for="red5">Large (20%)</label>
    </div>

    <small class="form-text text-muted">
      Wealth redistribution is money taken from each person and equally distributed amongst everyone else. 
      It can be thought of as a tax that fully and equally distributes as financial benefits.
    </small>
  </div>

  <div class="form-group">
    <label>Investment Amount</label>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="ia1" name="investmentAmount" value="0" checked>
      <label class="form-check-label" for="ia1">Off</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="ia2" name="investmentAmount" value="0.1">
      <label class="form-check-label" for="ia2">Small (10%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="ia3" name="investmentAmount" value="0.2">
      <label class="form-check-label" for="ia3">Moderate (20%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="ia4" name="investmentAmount" value="0.5">
      <label class="form-check-label" for="ia4">Large (50%)</label>
    </div>

    <small class="form-text text-muted">
      Determines how much each person spends on re-investing their wealth (buying shares).
      People buy shares when they can afford them, but they never spend more than this percent of their wealth. 
      Share price is determined by how many shares remain in the pool. 
      Fewer shares available means increased price of shares. Every cycle, dividends are paid to shareholders based on
      money in the investment pool.
    </small>

  </div>

  <div class="form-group">
    <label>Company Consumer Rate</label>
  
    <div class="form-check">
      <input class="form-check-input" type="radio" id="ic1" name="investmentChance" value="0.05" checked>
      <label class="form-check-label" for="ic1">Tiny (5%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="ic2" name="investmentChance" value="0.2">
      <label class="form-check-label" for="ic2">Moderate (20%)</label>
    </div>

    <div class="form-check">
      <input class="form-check-input" type="radio" id="ic3" name="investmentChance" value="0.5">
      <label class="form-check-label" for="ic3">Large (50%)</label>
    </div>

    <small class="form-text text-muted">
      This is the percentage of purchases that people spend on goods and services from companies instead of other people.
      This money goes to the investment pool and is distributed among shareholders.
      It is only enabled if investment amount is greater than 0%.
    </small>

  </div>

</div></div>

<div>
  <h2>Results</h2>
  <p>Poorest actor wealth $<span id="poorest"></span></p>
  <p>Richest actor wealth $<span id="richest"></span></p>
</div>

<button class="btn btn-primary" onclick="start()">Run</button>



</div></body>
</html>
